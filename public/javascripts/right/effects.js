/**
 * RightJS Additional visual effects module
 * http://rightjs.org/plugins/effects
 *
 * Copyright (C) 2008-2010 Nikolay Nemshilov
 */
(function(g){if(!g.Fx)throw"RightJS Fx is missing";var i=g,o=g.$,n=g.$w,p=g.$A,e=g.Fx,j=g.Class,h=g.Object,q=g.Element,k=g.defined,r=g.isHash,s=g.isString;e.Move=new j(e.Morph,{extend:{Options:h.merge(e.Options,{duration:"long",position:"absolute"})},prepare:function(a){return this.$super(this.getEndPosition(a))},getEndPosition:function(a){var b=this.element.getStyle("position"),c={};if(b!="absolute"||b!="relative")this.element._.style.position=b=b=="fixed"?"absolute":"relative";if(a.top)a.y=a.top.toInt();
if(a.left)a.x=a.left.toInt();var d=this.element.position(),f=this.getParentPosition(),l=d.x-f.x;f=d.y-f.y;if(this.options.position=="relative")if(b=="absolute"){if(k(a.x))a.x+=d.x;if(k(a.y))a.y+=d.x}else{if(k(a.x))a.x+=l;if(k(a.y))a.y+=f}else if(b=="relative"){if(k(a.x))a.x+=l-d.x;if(k(a.y))a.y+=f-d.y}for(var m in a)switch(m){case "top":case "left":break;case "y":c.top=a.y+"px";break;case "x":c.left=a.x+"px";break;default:c[m]=a[m]}return c},getParentPosition:function(){e.Move.Dummy=e.Move.Dummy||
new q("div",{style:"width:0;height:0;visibility:hidden"});this.element.insert(e.Move.Dummy,"before");var a=e.Move.Dummy.position();e.Move.Dummy.remove();return a}});e.Zoom=new j(e.Move,{PROPERTIES:n("width height lineHeight paddingTop paddingRight paddingBottom paddingLeft fontSize borderWidth"),extend:{Options:h.merge(e.Move.Options,{position:"relative",duration:"normal",from:"center"})},prepare:function(a,b){return this.$super(this._getZoomedStyle(a,b))},_getZoomedStyle:function(a,b){var c=this._getProportion(a);
return h.merge(this._getBasicStyle(c),this._getEndPosition(c),b||{})},_getProportion:function(a){if(r(a)){var b=$E("div").insertTo($E("div",{style:"visibility:hidden;float:left;height:0;width:0"}).insertTo(document.body)).setStyle(a).size();a=a.height?b.y/this.element.size().y:b.x/this.element.size().x}else if(s(a))a=i(a).endsWith("%")?i(a).toFloat()/100:i(a).toFloat();return a},_getBasicStyle:function(a){function b(l){return""+i(l).toFloat()*a}var c=this._cloneStyle(this.element,this.PROPERTIES),
d=/([\d\.]+)/g;for(var f in c){if(f==="width"||f==="height")c[f]=c[f]||this.element["offset"+i(f).capitalize()]+"px";if(c[f].match(d))c[f]=c[f].replace(d,b);else delete c[f]}if(c.borderWidth&&i(c.borderWidth).toFloat()<1)c.borderWidth="1px";return c},_getEndPosition:function(a){var b={},c=this.element.size(),d=c.x*(a-1);a=c.y*(a-1);switch(this.options.from.replace("-"," ").split(" ").sort().join("_")){case "top":b.x=-d/2;break;case "right":b.x=-d;b.y=-a/2;break;case "bottom":b.x=-d/2;case "bottom_left":b.y=
-a;break;case "bottom_right":b.y=-a;case "right_top":b.x=-d;break;case "center":b.x=-d/2;case "left":b.y=-a/2;break;default:}return b}});e.Bounce=new j(e,{extend:{Options:h.merge(e.Options,{duration:"short",direction:"top",value:16})},prepare:function(a){a=a||this.options.value;this.element.position();var b={duration:e.Durations[this.options.duration]||this.options.duration,position:"relative"},c="y";switch(this.options.direction){case "right":a=-a;case "left":c="x";break;case "bottom":a=-a}var d=
{},f={};d[c]=-a;f[c]=a;(new e.Move(this.element,b)).start(d);(new e.Move(this.element,b)).start(f);this.finish.bind(this).delay(1);return this}});e.Run=new j(e.Move,{extend:{Options:h.merge(e.Move.Options,{direction:"left"})},prepare:function(a){var b=a||"toggle";a={};var c=this.element.dimensions();if(b=="out"||b=="toggle"&&this.element.visible()){if(this.options.direction=="left")a.x=-c.width-80;else a.y=-c.height-80;this.onFinish(function(){this.element.hide().setStyle(this.getEndPosition({x:c.left,
y:c.top}))})}else{c=this.element.setStyle("visibility: hidden").show().dimensions();b={};if(this.options.direction=="left"){b.x=-c.width-80;a.x=c.left}else{b.y=-c.height-80;a.y=c.top}this.element.setStyle(this.getEndPosition(b)).setStyle("visibility: visible")}return this.$super(a)}});e.Puff=new j(e.Zoom,{extend:{Options:h.merge(e.Zoom.Options,{size:1.4})},prepare:function(a){var b=a||"toggle",c=0;a=this.options.size;var d;if(b=="out"||b=="toggle"&&this.element.visible()){d=this.getEndPosition(this._getZoomedStyle(1));
this.onFinish(function(){d.opacity=1;this.element.hide().setStyle(d)})}else{this.element.setStyle("visibility: visible").show();b=this.element.offsetWidth;d=this.getEndPosition(this._getZoomedStyle(1));this.onFinish(function(){this.element.setStyle(d)});this.element.setStyle(h.merge(this.getEndPosition(this._getZoomedStyle(a)),{opacity:0,visibility:"visible"}));a=b/this.element.offsetWidth;c=1}return this.$super(a,{opacity:c})}});e.Css=e.CSS=new j(e.Morph,{STYLES:n("width height lineHeight opacity border padding margin color fontSize background top left right bottom"),
prepare:function(a,b){this.addClass=a||"";this.removeClass=b||"";a&&this.onFinish(this.element.addClass.bind(this.element,a));b&&this.onFinish(this.element.removeClass.bind(this.element,b));return this.$super({})},_endStyle:function(a,b){var c=this.element,d=o(c._.cloneNode(true)).setStyle("position:absolute;z-index:-1;visibility:hidden").setWidth(c.size().x).addClass(this.addClass).removeClass(this.removeClass);c._.parentNode&&c.insert(d,"before");c=this._cloneStyle(d,b);d.remove();return c},_styleKeys:function(){var a=
{};this.STYLES.each(function(b){a[b]=1});return this.$super(a)}});g.Element.include({move:function(a,b){return this.fx("move",[a,b||{}])},bounce:function(){return this.fx("bounce",arguments)},zoom:function(a,b){return this.fx("zoom",[a,b||{}])},run:function(){return this.fx("run",arguments)},puff:function(){return this.fx("puff",arguments)},morphToClass:function(){var a=p(arguments);if(a[0]===null)a[0]="";return this.fx("CSS",a)}})})(RightJS);
